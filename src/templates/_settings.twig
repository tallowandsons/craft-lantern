{# @var plugin \tallowandsons\lantern\Lantern #}
{# @var settings \tallowandsons\lantern\models\Settings #}

{% import '_includes/forms.twig' as forms %}

<div class="field">
    <div class="heading"><label for="staleDays">Stale after (days)</label></div>
    {{ forms.textField({
        id: 'staleDays',
        name: 'staleDays',
        value: settings.staleDays,
        size: 4,
        type: 'number',
        min: 1
    }) }}
</div>

<div class="field">
    <div class="heading"><label for="newTemplateDays">New template window (days)</label></div>
    {{ forms.textField({
        id: 'newTemplateDays',
        name: 'newTemplateDays',
        value: settings.newTemplateDays,
        size: 4,
        type: 'number',
        min: 1
    }) }}
</div>

<hr>

<h3>Aggregation &amp; Retention</h3>

<div class="field">
    <div class="heading"><label for="dailyRetentionDays">Keep daily data (days)</label></div>
    {{ forms.textField({
        id: 'dailyRetentionDays',
        name: 'dailyRetentionDays',
        value: settings.dailyRetentionDays,
        size: 4,
        type: 'number',
        min: 0
    }) }}
    <p class="light">Keep recent daily rows for high-resolution charts (0 = disable daily pruning).</p>
    <p class="light">Monthly aggregation always processes completed months only.</p>
    <p class="light">Tip: 90 days is a good default.</p>

    <div class="heading" style="margin-top: 1rem;"><label for="monthlyRetentionMonths">Keep monthly data (months)</label></div>
    {{ forms.textField({
        id: 'monthlyRetentionMonths',
        name: 'monthlyRetentionMonths',
        value: settings.monthlyRetentionMonths,
        size: 4,
        type: 'number',
        min: 0
    }) }}
    <p class="light">Keep long-term monthly rows for trend analysis (0 = keep all months).</p>

    <div class="heading" style="margin-top: 1rem;"><label for="prune">Prune after aggregation</label></div>
    {{ forms.lightswitchField({
        id: 'prune',
        name: 'prune',
        on: settings.prune,
        onLabel: 'Enabled',
        offLabel: 'Disabled'
    }) }}
</div>

<hr>

<h3>Autoâ€‘Flush (background)</h3>

<div class="field">
    {{ forms.lightswitchField({
        id: 'autoFlushEnabled',
        name: 'autoFlushEnabled',
        on: settings.autoFlushEnabled,
        label: 'Enable auto-flush to database',
        instructions: 'Queues a background job to persist cache to DB, without blocking web requests.'
    }) }}
</div>

<div class="field">
    {{ forms.textField({
        id: 'autoFlushIntervalSeconds',
        name: 'autoFlushIntervalSeconds',
        value: settings.autoFlushIntervalSeconds,
        size: 6,
        type: 'number',
        min: 60,
        label: 'Minimum interval (seconds)',
        instructions: 'Debounce time between background flushes (minimum 60s).'
    }) }}
</div>


<div class="field">
    {{ forms.lightswitchField({
        id: 'autoFlushOnlyOnCpRequests',
        name: 'autoFlushOnlyOnCpRequests',
        on: settings.autoFlushOnlyOnCpRequests,
        label: 'Only queue from Control Panel requests',
        instructions: 'If enabled, frontend requests will not queue a flush.'
    }) }}
</div>

<div class="field">
    {{ forms.textField({
        id: 'aggregateIntervalSeconds',
        name: 'aggregateIntervalSeconds',
        value: settings.aggregateIntervalSeconds,
        size: 6,
        type: 'number',
        min: 600,
        label: 'Aggregation interval (seconds)',
        instructions: 'Minimum time between monthly aggregation runs. Default 12 hours (43200).'
    }) }}
</div>
